#!/usr/bin/env python

import yaml

#-----------------------------------------------------------------------------
# Create a function that prints to stderr and optionally exits with an error code that defaults to 1, AI!

#-----------------------------------------------------------------------------
def load_yaml_file(yaml_file_path):
    try:
        with open(yaml_file_path, 'r') as file:
            data = yaml.safe_load(file)
            if data is None:
                raise ValueError("YAML file is empty or contains null data.")
            return data

    except FileNotFoundError:
        print(f"Error: The file {yaml_file_path} was not found.")
        raise

    except PermissionError:
        print(f"Error: Permission denied for file {yaml_file_path}.")
        raise

    except yaml.YAMLError as exc:
        print(f"Error parsing YAML file: {exc}")
        raise

#-----------------------------------------------------------------------------
def parse_yaml_to_markdown(yaml_file_path):
    yaml_content = load_yaml_file(yaml_file_path)

    # Extract parameters
    parameters = yaml_content.get('parameters', [])

    # Prepare markdown table
    markdown_table = "| Name | Type | Default | Description |\n"
    markdown_table += "|------|------|---------|-------------|\n"

    for param in parameters:
        name = param.get('name', '')
        param_type = param.get('type', '')
        default = param.get('default', '')
        description = param.get('description', '')

        markdown_table += f"| {name} | {param_type} | {default} | {description} |\n"

    return markdown_table

# Example usage
yaml_file_path = 'azure-pipelines.yml'  # Replace with your YAML file path
markdown_output = parse_yaml_to_markdown(yaml_file_path)
print(markdown_output)
