#!/usr/bin/env python

import yaml
import sys

class ADOPipelineDocException(Exception):
    pass

class ADOPipelineDoc:
    def __init__(self, yaml_file_path=None):
        self.yaml_file_path = yaml_file_path
        self.yaml_content = None

        if self.yaml_file_path is not None:
            self.load_file()

    def load_file(self):
        """
        Loads a YAML file and returns its contents as a Python dictionary.

        Returns:
            dict: The contents of the YAML file.

        Raises:
            ADOPipelineDocException: If there is an error related to file access or YAML parsing.
        """
        try:
            with open(self.yaml_file_path, 'r') as file:
                data = yaml.safe_load(file)

                if data is None:
                    raise ADOPipelineDocException("YAML file is empty or contains null data.")

                self.yaml_content = data

        except FileNotFoundError:
            raise ADOPipelineDocException(f"Error: The file {self.yaml_file_path} was not found.")

        except PermissionError:
            raise ADOPipelineDocException(f"Error: Permission denied for file {self.yaml_file_path}.")

        except yaml.YAMLError as exc:
            raise ADOPipelineDocException(f"Error parsing YAML file: {exc}")

    def get_parameters(self):
        """
        Extracts parameters from the YAML content.

        Returns:
            list: A list of parameters extracted from the YAML content.

        Raises:
            ADOPipelineDocException: If no parameters are found in the YAML content.
        """
        parameters = self.yaml_content.get('parameters', [])

        if not parameters:
            raise ADOPipelineDocException("No parameters found.")
        return parameters

    def process_data(self):
        self.load_file()
        parameters = self.get_parameters()

        # Prepare markdown table
        markdown_table = "| Name | Type | Default | Description |\n"
        markdown_table += "|------|------|---------|-------------|\n"

        for param in parameters:
            name = param.get('name', '')
            param_type = param.get('type', '')
            default = param.get('default', '')
            description = param.get('description', '')

            markdown_table += f"| {name} | {param_type} | {default} | {description} |\n"

        return markdown_table

# Example usage
yaml_processor = ADOPipelineDoc('azure-pipelines.yml')  # Replace with your YAML file path
markdown_output = yaml_processor.process_data()
print(markdown_output)
