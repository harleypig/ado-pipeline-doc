#!/usr/bin/env python

import yaml
import sys

#-----------------------------------------------------------------------------
def warn(message, ec=None):
    """Prints an error message to stderr and optionally exits with the given error code."""
    print(message, file=sys.stderr)

    if ec is not None:
        sys.exit(ec)

#-----------------------------------------------------------------------------
def load_file(yaml_file_path):
    try:
        with open(yaml_file_path, 'r') as file:
            data = yaml.safe_load(file)
            if data is None:
                raise ValueError("YAML file is empty or contains null data.")
            return data

    except FileNotFoundError:
        warn(f"Error: The file {yaml_file_path} was not found.", ec=1)

    except PermissionError:
        warn(f"Error: Permission denied for file {yaml_file_path}.", ec=1)

    except yaml.YAMLError as exc:
        warn(f"Error parsing YAML file: {exc}", ec=1)

#-----------------------------------------------------------------------------
def parse_yaml_to_markdown(yaml_file_path):
    yaml_content = load_file(yaml_file_path)

    # Extract parameters
    parameters = yaml_content.get('parameters', [])

    # Prepare markdown table
    markdown_table = "| Name | Type | Default | Description |\n"
    markdown_table += "|------|------|---------|-------------|\n"

    for param in parameters:
        name = param.get('name', '')
        param_type = param.get('type', '')
        default = param.get('default', '')
        description = param.get('description', '')

        markdown_table += f"| {name} | {param_type} | {default} | {description} |\n"

    return markdown_table

# Example usage
yaml_file_path = 'azure-pipelines.yml'  # Replace with your YAML file path
markdown_output = parse_yaml_to_markdown(yaml_file_path)
print(markdown_output)
